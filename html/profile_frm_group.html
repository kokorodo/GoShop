<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>个人中心</title>
    <link rel="stylesheet" type="text/css" href="../css/aui.css"/>
    <link rel="stylesheet" type="text/css" href="../css/font-awesome.css"/>
    <link rel="stylesheet" type="text/css" href="../css/font-glyphicons.css"/>
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <style>
    </style>
</head>
<body>

<div class="aui-content" id="page">
<section class="aui-content aui-margin-b-15 aui-margin-t-15" id="user-info">
    <div class="aui-list aui-media-list aui-list-noborder" tapmode onclick="$yugo.openLoginWin();return false;">
        <div class="aui-list-item aui-list-item-middle aui-text-center aui-padded-0">
          <div class="aui-label aui-label-outlined" style="vertical-align: middle;padding: 10px;margin-top: 10px;margin-bottom: 10px;">点击登录</div>
        </div>
    </div>
</section>
<section class="aui-content aui-grid aui-margin-b-15">
    <div class="aui-row">
        <div class="aui-col-xs-4 aui-border-r">
            <big class="aui-text-warning">0<small> 元</small></big>
            <div class="aui-gird-lable aui-font-size-12">余额</div>
        </div>
        <div class="aui-col-xs-4">
            <big class="aui-text-success">0<small> 分</small></big>
            <div class="aui-gird-lable aui-font-size-12">消费积分</div>
        </div>
        <div class="aui-col-xs-4 aui-border-r">
            <big class="aui-text-danger">0<small> 分</small></big>
            <div class="aui-gird-lable aui-font-size-12">等级积分</div>
        </div>
    </div>
</section>
<section class="aui-content aui-margin-b-15">
    <ul class="aui-list aui-list-in aui-margin-b-15">
        <li class="aui-list-item" tapmode onclick="">
            <div class="aui-list-item-label-icon">
                <i class="aui-iconfont aui-icon-location aui-text-info"></i>
            </div>
            <div class="aui-list-item-inner aui-list-item-arrow">
                <div class="aui-list-item-title">收货地址</div>
            </div>
        </li>
        <li class="aui-list-item" tapmode onclick="openMyFavoritesWin();return false;">
            <div class="aui-list-item-label-icon">
                <i class="aui-iconfont aui-icon-like aui-text-danger"></i>
            </div>
            <div class="aui-list-item-inner aui-list-item-arrow">
                <div class="aui-list-item-title">我的收藏</div>
            </div>
        </li>
        <li class="aui-list-item" tapmode onclick="">
            <div class="aui-list-item-label-icon">
                <i class="aui-iconfont aui-icon-cart aui-text-info"></i>
            </div>
            <div class="aui-list-item-inner aui-list-item-arrow">
                <div class="aui-list-item-title">我的订单</div>
            </div>
        </li>
    </ul>
    <ul class="aui-list aui-list-in">
        <li class="aui-list-item" tapmode onclick="">
            <div class="aui-list-item-label-icon">
                <i class="aui-iconfont aui-icon-comment aui-text-info"></i>
            </div>
            <div class="aui-list-item-inner aui-list-item-arrow">
                <div class="aui-list-item-title">我的咨询</div>
            </div>
        </li>
    </ul>
</section>
</div>
    

<script type="text/x-dot-template" id="profile-tpl">
<!-- 顶部 -->
<section class="aui-content aui-margin-b-15 aui-margin-t-15" id="user-info">
    {{? !it.isLogin }}
    <div class="aui-list aui-media-list aui-list-noborder" tapmode onclick="$yugo.openLoginWin();return false;">
        <div class="aui-list-item aui-list-item-middle aui-text-center aui-padded-0">
          <div class="aui-label aui-label-outlined" style="vertical-align: middle;padding: 10px;margin-top: 10px;margin-bottom: 10px;">点击登录</div>
        </div>
    </div>
    {{?? }}
    <div class="aui-list aui-media-list aui-list-noborder">
        <div class="aui-list-item aui-list-item-middle">
            <div class="aui-media-list-item-inner ">
                <div class="aui-list-item-media" style="width:3rem;">
                    <img src="{{= it.avatar}}" class="aui-img-round" >
                </div>
                <div class="aui-list-item-inner aui-list-item-arrow">
                    <div class="aui-list-item-text text-white aui-font-size-18">{{= it.nickName }}({{= it.userGroupName}})</div>
                    <div class="aui-list-item-text text-white">
                       <div><i class="aui-iconfont aui-icon-mobile aui-font-size-14"></i>{{= !it.userPhone?'未知':it.userPhone}}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {{? }}
</section>
<section class="aui-content aui-grid aui-margin-b-15">
    <div class="aui-row">
        <div class="aui-col-xs-4 aui-border-r">
            <big class="aui-text-warning">{{= !it.userMoney?'0.00':it.userMoney}}<small> 元</small></big>
            <div class="aui-gird-lable aui-font-size-12">余额</div>
        </div>
        <div class="aui-col-xs-4">
            <big class="aui-text-success">{{= !it.userIntegralNum?0:it.userIntegralNum}}<small> 分</small></big>
            <div class="aui-gird-lable aui-font-size-12">消费积分</div>
        </div>
        <div class="aui-col-xs-4 aui-border-r">
            <big class="aui-text-danger">{{= !it.integralType2Num?0:it.integralType2Num}}<small> 分</small></big>
            <div class="aui-gird-lable aui-font-size-12">等级积分</div>
        </div>
    </div>
</section>
<section class="aui-content aui-margin-b-15">
    <ul class="aui-list aui-list-in aui-margin-b-15">
        <li class="aui-list-item" tapmode onclick="openAddressWin();return false;">
            <div class="aui-list-item-label-icon">
                <i class="aui-iconfont aui-icon-location aui-text-info"></i>
            </div>
            <div class="aui-list-item-inner aui-list-item-arrow">
                <div class="aui-list-item-title">收货地址</div>
            </div>
        </li>
        <li class="aui-list-item" tapmode onclick="openMyFavoritesWin();return false;">
            <div class="aui-list-item-label-icon">
                <i class="aui-iconfont aui-icon-like aui-text-danger"></i>
            </div>
            <div class="aui-list-item-inner aui-list-item-arrow">
                <div class="aui-list-item-title">我的收藏</div>
            </div>
        </li>
        <li class="aui-list-item" tapmode onclick="openOrderWin();return false;">
            <div class="aui-list-item-label-icon">
                <i class="aui-iconfont aui-icon-cart aui-text-info"></i>
            </div>
            <div class="aui-list-item-inner aui-list-item-arrow">
                <div class="aui-list-item-title">我的订单</div>
            </div>
        </li>
    </ul>
    <ul class="aui-list aui-list-in">
        <li class="aui-list-item" tapmode onclick="openMyAskWin();return false;">
            <div class="aui-list-item-label-icon">
                <i class="aui-iconfont aui-icon-comment aui-text-info"></i>
            </div>
            <div class="aui-list-item-inner aui-list-item-arrow">
                <div class="aui-list-item-title">我的咨询</div>
            </div>
        </li>
        {{? it.isLogin }}
        <li class="aui-list-item" tapmode onclick="doLoginOut();return false;">
            <div class="aui-list-item-label-icon">
                <i class="fa fa-sign-out aui-text-default"></i>
            </div>
            <div class="aui-list-item-inner">
                <div class="aui-list-item-title">退出</div>
            </div>
        </li>
        {{?  }}
    </ul>
</section>

</script>  
  
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/zepto.min.js"></script>
<script type="text/javascript" src="../script/doT.min.js"></script>
<script type="text/javascript" src="../script/shop.js"></script>
<script type="text/javascript" src="../script/yugo.js"></script>

<script type="text/javascript">
var dot;

apiready = function(){
  var template = $api.byId('profile-tpl');
  dot = doT.template(template.innerHTML);
  
  api.addEventListener({
    name: 'loginEvent'
  }, function(ret, err) {
      //alert(JSON.stringify(ret.value));
      fmtPage();   
  });
  
   api.setRefreshHeaderInfo({
      visible: true,
      loadingImg: 'widget://image/loading_more.gif',
      bgColor: '#ccc',
      textColor: '#fff',
      textDown: '下拉更新用户信息...',
      textUp: '松开刷新用户信息...',
      showTime: true
    }, function(ret, err) {
        refreshUserInfo();
        api.refreshHeaderLoadDone();
    });
  

  fmtPage();   
}


function fmtPage(){
   var user = {};
   var token = $api.getStorage('userToken');
   if($yugo.isLogon()){
     user['username'] = $api.getStorage('username');
     user['nickName'] = $api.getStorage('nickName');
     user['avatar'] = $api.getStorage('avatar');
     user['userToken'] = token;
     user['unionid'] = $api.getStorage('unionid');
     user['isLogin'] = $api.getStorage('loginFlag');
     
     user['userId'] = $api.getStorage('userId');
     user['userEmail'] = $api.getStorage('userEmail');
     user['userPhone'] = $api.getStorage('userPhone');
     user['groupId'] = $api.getStorage('groupId');
     user['userGroupName'] = $api.getStorage('userGroupName');
     user['userSex'] = $api.getStorage('userSex');
     user['userBirthday'] = $api.getStorage('userBirthday');
     user['userIntegralNum'] = $api.getStorage('userIntegralNum');
     user['integralType2Num'] = $api.getStorage('integralType2Num');
     user['userMoney'] = $api.getStorage('userMoney');
     
     
   }
   //console.log(JSON.stringify(user));
   //console.log(user.isLogin);
   
   
   $api.html($api.byId('page'), dot(user));
   api.parseTapmode();
}



function doLoginOut(){
  if(!confirm('请确认是否退出？')) return ;
  var token = $api.getStorage('userToken');
  $yugo.cleanLoginStorage();
  $shop.logout(token,function(resp){
    fmtPage();
  });
}


function refreshUserInfo(){
  var token = $api.getStorage('userToken')
  if(null == token || '' == token){
    api.toast({
	    msg:'请先登录！'
    });
    return ;
  }
  $shop.getUserInfo(token,function(resp1){
    var obj = resp1.result;
    $yugo.storageUserInfo(obj);
    fmtPage();
  });
}


function openAddressWin(addressId){
  var p = {};
  if('string' == typeof(addressId)){
    p['addressId'] = addressId;
  }
  if($yugo.isLogon()){
    $yugo.openAddressWin(p);
  } else {
    api.toast({
      msg:'请登录后再执行该操作！'
    });
  }
}


function openOrderWin(){
  if($yugo.isLogon()){
    api.openWin({
      name: 'My_Order_Win',
      url: 'my_order_list_win.html',
      showProgress : true,
      pageParam : {}
    });
  } else {
    api.toast({
      msg:'请登录后再执行该操作！'
    });
  }
}


function openMyFavoritesWin(){
  if($yugo.isLogon()){
    api.openWin({
      name: 'My_Favorites_Win',
      url: 'my_favorites_list_win.html',
      showProgress : true,
      pageParam : {}
    });
  } else {
    api.toast({
	    msg:'请登录后再执行该操作！'
    });
  }
}


function openMyAskWin(){
  if($yugo.isLogon()){
    api.openWin({
      name: 'My_Ask_Win',
      url: 'my_ask_list_win.html',
      showProgress : true,
      pageParam : {}
    });
  } else {
    api.toast({
      msg:'请登录后再执行该操作！'
    });
  }
}


/** 调试用，需要删除或者注释掉 */
//$(function(){
//  apiready();
//})
</script>

</body>
</html>